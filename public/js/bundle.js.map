{"mappings":"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","sources":["public/js/index.js","public/js/leaflet.js","public/js/login.js","public/js/alert.js","public/js/updateSettings.js"],"sourcesContent":["/* eslint-disable node/no-unsupported-features/es-syntax */\r\n// import '@babel/polyfill';\r\nimport { displayMap } from './leaflet';\r\nimport { login, logout } from './login';\r\nimport { updateSettings } from './updateSettings';\r\n\r\n// DOM ELEMENTS\r\nconst leaflet = document.getElementById('map');\r\nconst loginForm = document.querySelector('.form--login');\r\nconst logoutBtn = document.querySelector('.nav__el--logout');\r\nconst userDataForm = document.querySelector('.form-user-data');\r\nconst userPasswordForm = document.querySelector('.form-user-password');\r\n\r\n// VALUES\r\n\r\nif (leaflet) {\r\n  const locations = JSON.parse(\r\n    document.getElementById('map').dataset.locations\r\n  );\r\n  displayMap(locations);\r\n  // console.log(locations);\r\n}\r\n\r\nif (loginForm) {\r\n  loginForm.addEventListener('submit', (e) => {\r\n    e.preventDefault();\r\n    const email = document.getElementById('email').value;\r\n    const password = document.getElementById('password').value;\r\n\r\n    login({ email, password });\r\n  });\r\n}\r\n\r\nif (logoutBtn) logoutBtn.addEventListener('click', logout);\r\n\r\nif (userDataForm)\r\n  userDataForm.addEventListener('submit', (e) => {\r\n    e.preventDefault();\r\n    const name = ('name', document.getElementById('name').value);\r\n    const email = ('email', document.getElementById('email').value);\r\n    const photo = ('photo', document.getElementById('photo').files);\r\n\r\n    updateSettings({ name, email, photo }, 'data');\r\n  });\r\n\r\nif (userPasswordForm)\r\n  userPasswordForm.addEventListener('submit', async (e) => {\r\n    e.preventDefault();\r\n    const passwordCurrent = document.getElementById('password-current').value;\r\n    const password = document.getElementById('password').value;\r\n    const passwordConfirm = document.getElementById('password-confirm').value;\r\n    await updateSettings(\r\n      { password, passwordCurrent, passwordConfirm },\r\n      'password'\r\n    );\r\n\r\n    document.getElementById('password-current').value = '';\r\n    document.getElementById('password').value = '';\r\n    document.getElementById('password-confirm').value = '';\r\n  });\r\n","/* eslint-disable */\r\n\r\nexport const displayMap = (locations) => {\r\n  let map = L.map('map', { zoomControl: false });\r\n\r\n  L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {\r\n    attribution:\r\n      '&copy; <a href=\"https://www.openstreetmap.org/copyright\">OpenStreetMap</a> contributors',\r\n  }).addTo(map);\r\n\r\n  const points = [];\r\n  locations.forEach((loc) => {\r\n    points.push([loc.coordinates[1], loc.coordinates[0]]);\r\n    L.marker([loc.coordinates[1], loc.coordinates[0]])\r\n      .addTo(map)\r\n      .bindPopup(`<p>Day ${loc.day}: ${loc.description}</p>`, {\r\n        autoClose: false,\r\n      })\r\n      .openPopup();\r\n  });\r\n\r\n  const bounds = L.latLngBounds(points).pad(0.5);\r\n  map.fitBounds(bounds);\r\n\r\n  map.scrollWheelZoom.disable();\r\n};\r\n","/* eslint-disable */\r\nimport { showAlert } from './alert';\r\n\r\nexport const login = async (obj) => {\r\n  try {\r\n    let res = await fetch('/api/v1/users/login', {\r\n      method: 'POST',\r\n      headers: {\r\n        Accept: 'application/json',\r\n        'Content-Type': 'application/json',\r\n      },\r\n      body: JSON.stringify({\r\n        email: obj.email,\r\n        password: obj.password,\r\n      }),\r\n    });\r\n    res = await res.json();\r\n    console.log(res);\r\n\r\n    if (res.status === 'success') {\r\n      showAlert('success', 'Logged in successfully');\r\n      window.setTimeout(() => {\r\n        location.assign('/');\r\n      }, 1000);\r\n    } else {\r\n      throw err;\r\n    }\r\n  } catch (err) {\r\n    // console.log('hi');\r\n    showAlert('error', 'Please provide valid email or password');\r\n  }\r\n};\r\n\r\nexport const logout = async () => {\r\n  try {\r\n    let res = await fetch('/api/v1/users/logout');\r\n    console.log(res);\r\n\r\n    if (res.status === 200) {\r\n      location.reload(true);\r\n    }\r\n  } catch (err) {\r\n    // console.log(err);\r\n    showAlert('error', 'Error Logging out.');\r\n  }\r\n};\r\n","/* eslint-disable */\r\nexport const hideAlert = () => {\r\n  const el = document.querySelector('.alert');\r\n  if (el) {\r\n    console.log(el.parentElement, el);\r\n    el.parentElement.removeChild('el');\r\n  }\r\n};\r\n\r\nexport const showAlert = (type, msg) => {\r\n  hideAlert();\r\n  const markup = `<div class=\"alert alert--${type}\">${msg}</div>`;\r\n  document.querySelector('body').insertAdjacentHTML('afterbegin', markup);\r\n  window.setTimeout(hideAlert, 5000);\r\n};\r\n","/*eslint-disable*/\r\n\r\nimport { showAlert } from './alert';\r\n\r\nconst jsonFormData = async (formData) => {\r\n  const plainFormData = Object.fromEntries(formData.entries());\r\n  // console.log(plainFormData);\r\n  return JSON.stringify(plainFormData);\r\n};\r\n\r\nexport const updateSettings = async (data, type) => {\r\n  const dt = { ...data };\r\n  let options = {\r\n    method: 'PATCH',\r\n    headers: {\r\n      Accept: 'application/json',\r\n      'Content-Type': 'application/json',\r\n    },\r\n  };\r\n  try {\r\n    let url = '/api/v1/users/';\r\n\r\n    if (type === 'password') {\r\n      url += 'updatePassword';\r\n      options.body = JSON.stringify(dt);\r\n    } else {\r\n      url += 'updateMe';\r\n      let form = new FormData();\r\n      form.append('name', dt.name);\r\n      form.append('email', dt.email);\r\n      form.append('photo', dt.photo[0]);\r\n      // console.log(dt.photo[0]);\r\n      options.body = await jsonFormData(form);\r\n      // console.log(await options.body);\r\n    }\r\n\r\n    let res = await fetch(url, options);\r\n\r\n    if (res.status === 200) {\r\n      // console.log('hi');\r\n      showAlert('success', `${type.toUpperCase()} updated successfully`);\r\n    }\r\n  } catch (err) {\r\n    console.log('error', err);\r\n  }\r\n};\r\n"],"names":[],"version":3,"file":"bundle.js.map","sourceRoot":"../../"}